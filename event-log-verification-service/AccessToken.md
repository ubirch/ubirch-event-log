## Access Token (Work In Process)

_**WIP**_: The definition and concepts that are presented here are work in process and might change.

In order for a verification request be received and executed, the initiator  must provide proof that it has been granted with the required permissions. In order to do so, its verification request must contain an Authorization header. 

#### The Header

```
Authorization: <type> <token>

where 
  <type> is Bearer
  <token> is the JWT token generated by the tenant/customer.

``` 
  
#### The Responses

```
The <response> codes could be:


1. <200 OK>           When the system found a proper verification.
2. <404 Not Found>    When no verfication was found or successful.
3. <403 Forbidden>    When the token is invalid.
4. <401 Unauthorized> When no Authorization header is found in the request.
                      In this case, the response will contain the following header 
                      WWW-Authenticate: <type> realm=<realm>
                      
                      where <type> is Bearer and
                           <realm> is "Verification Access"
```


#### Example

```
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJpc3MiOiJodHRwczovL3Rva2VuLmRldi51YmlyY2guY29tIiwic3ViIjoiOTYzOTk1ZWQtY2UxMi00ZWE1LTg5ZGMtYjE4MTcwMWQxZDdiIiwiYXVkIjoiaHR0cHM6Ly92ZXJpZnkuZGV2LnViaXJjaC5jb20iLCJleHAiOjc5MjE1MzU0NzMsImlhdCI6MTYxMDE0NTA3MywianRpIjoiZjM1OWVhZjEtMmE5MS00NDYyLTk2MmItNWM4NTUyM2JhZmFkIiwicHVycG9zZSI6IlNoYXJrIFRhbmsgLSBNZXhpY28iLCJ0YXJnZXRfaWRlbnRpdGllcyI6WyI3NTQ5YWNkOC05MWUxLTQyMzAtODMzYS0yZjM4NmUwOWI5NmYiXSwicm9sZSI6InZlcmlmaWVyIiwic2NvcGUiOiJ2ZXIifQ.Xv2ITreHDbt9D48adjx0NnO_ZXU5CciG4-ooIprn32Fxu5VTFRr_t3vZM8b39lLmIPzoMZB-d3wGWOtuVGPCkA
```

This token has the following header:

```json
{
  "typ": "JWT",
  "alg": "ES256"
}
```

```json
{
  "iss": "https://token.dev.ubirch.com",
  "sub": "963995ed-ce12-4ea5-89dc-b181701d1d7b",
  "aud": "https://verify.dev.ubirch.com",
  "exp": 7921535473,
  "iat": 1610145073,
  "jti": "f359eaf1-2a91-4462-962b-5c85523bafad",
  "purpose": "Shark Tank - Mexico",
  "target_identities": [
    "7549acd8-91e1-4230-833a-2f386e09b96f"
  ],
  "role": "verifier",
  "scope": "ver"
}
```

```
Where 
    'iss' is Principal Entity that signs/issues the token: The Token Manager.
    'sub' is the purpose or subject for this token: The tenantId/UserId from Keycloak 
    'aud' target entity: The target system, in this token, the Verfication Service.  
    'exp' is the expiration time
    'iat' is the initial time
    'jti' is a unique uuid id for the token
    'purpose' is a description of the main usage for this token, like a concert or artist show
    'target_identities': it is the entities for which the subject can perform the action on the target audience system
    'role' is the role that was assigned to this token
    'scope' is the action allowed for this token.
```


#### Helper to Create Key Pairs and JWT

As a simple tool to generate testing tokens and/or key pairs, you can take a look at:
_/com/ubirch/verification/services/TokenCreation.scala_

For production tokens, tokens are issued by the Token Manager: https://github.com/ubirch/ubirch-token-manager
 
        


